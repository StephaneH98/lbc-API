version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "ðŸ”§ DÃ©but du build Amplify..."
        - echo "ðŸ“ RÃ©pertoire de travail:" && pwd
        - echo "ðŸ“‚ Fichiers prÃ©sents:" && ls -la
        - echo ""
        - echo "ðŸ”‘ Variables d'environnement disponibles:"
        - echo "  API_URL = $API_URL"
        - echo "  AWS_REGION = $AWS_REGION"
        - echo "  ENVIRONMENT = $ENVIRONMENT"
        - echo ""
    
    build:
      commands:
        - echo "ðŸš€ GÃ©nÃ©ration de env-config.js..."
        # CrÃ©er le fichier env-config.js avec les variables Amplify
        - |
          cat > env-config.js << 'EOF'
          // âš ï¸ Fichier AUTO-GÃ‰NÃ‰RÃ‰ par AWS Amplify
          // Les valeurs proviennent des variables d'environnement Amplify
          
          window.ENV = {
              API_URL: '$API_URL',
              BUCKET_NAME: '$BUCKET_NAME',
              REGION: '$AWS_REGION'
          };
          
          console.log('ðŸŒ Variables d\'environnement injectÃ©es par Amplify:');
          console.log('  ðŸ”— API_URL:', window.ENV.API_URL);
          console.log('  ðŸª£ BUCKET_NAME:', window.ENV.BUCKET_NAME);
          console.log('  ðŸŒ REGION:', window.ENV.REGION);
          EOF
        
        # Remplacer les placeholders par les vraies valeurs
        - sed -i "s|\$API_URL|$API_URL|g" env-config.js
        - sed -i "s|\$BUCKET_NAME|$BUCKET_NAME|g" env-config.js
        - sed -i "s|\$AWS_REGION|$AWS_REGION|g" env-config.js
        
        - echo "âœ… env-config.js gÃ©nÃ©rÃ© avec succÃ¨s:"
        - cat env-config.js
        - echo ""
        - echo "ðŸ“¦ Fichiers finaux avant dÃ©ploiement:"
        - ls -la

  artifacts:
    baseDirectory: public
    files:
      - '**/*'
  cache:
    paths: []